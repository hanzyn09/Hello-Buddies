<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My-Tama-Friend</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">   
<style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            padding-top: 30px;
        }
        .container {
            max-width: 900px;
            background-color: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }
        h3 {
            text-align: center;
            color: #5e3a8c;
            margin-bottom: 20px;
        }
        .profile-image {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 50%;
            border: 5px solid #ddd;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .tamagotchi-name {
            font-size: 28px; /* 글씨 크기 증가 */
            font-weight: bold; /* 글씨 두껍게 */
            color: #5e3a8c; /* 보라색 */
            margin-top: 10px; /* 이미지와 이름 사이의 여백 */
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1); /* 그림자 효과로 더 부각 */
        }
        .tamagotchi-status {
		    font-weight: bold;
		    font-size: 18px;
		    margin-top: 10px;
		}
		
		.tamagotchi-status.happy {
		    color: #7ed957; /* 행복한 상태일 때 밝은 초록색 */
		}
		
		.tamagotchi-status.sad {
		    color: #e74c3c; /* 슬픈 상태일 때 빨간색 */
		}

        .btn {
            padding: 10px 20px;
            border-radius: 50px;
            background-color: var(--secondary-color);
            color: white;
            font-size: 16px;
            text-decoration: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            border: none; /* 버튼 테두리 없애기 */
        }
        
        .btn-hunger {
            background-color: #C58CDC;
        }
        .btn-hunger:hover {
            background-color: #A274B6;
        }
        
        .btn-sleep {    
		    background-color: #9b59b6; 
		    color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 16px;
            text-decoration: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border: none; /* 버튼 테두리 없애기 */
        }
        .btn-sleep:hover { 
            background-color: #8e44ad; 
            color: black;
        }
        
        .btn-play {
            background-color: #6a4c9c;
		    color: white;
        }
        .btn-play:hover {
            background-color: #5c3a73; /* 더 진하고 어두운 보라색 */
            color: black;
        }
        
        .btn-danger {
            background-color: #e74c3c;
        }
         
        .btn:focus,
		.btn:active {
		    outline: none;   /* 포커스 및 클릭 시 테두리 제거 */
		    box-shadow: none; /* 포커스 및 클릭 시 그림자 제거 */
		}
		
        .table td {
            vertical-align: middle;
        }

        .profile-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }

        .table-section {
            margin-bottom: 10px;
        }

        .btn-group {
            margin-top: 10px;
            margin-bottom: 10px;
            width: 100%;
        }
         .btn-back {
            background-color: #FFE942; /* 밝은 노란색 */
		    color: #6a4c9c;
            font-size: 18px;
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 20px;
            align-self: center;
        }
        .btn-back:hover {
            background-color: #D8C217; /* 더 밝은 노란색 (호버 시) */
            color: white;
        }
        /* 버튼 감싸는 div 스타일 */
        .btn-wrapper {
            display: flex;
            justify-content: center; /* 버튼 중앙 정렬 */
            margin-top: 10px; /* 버튼과 컨테이너 사이의 간격을 조정 */
        }
         .icon {
            margin-right: 8px; /* 아이콘과 텍스트 사이 간격 */
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 프로필 이미지 -->
        <div class="profile-section">
        	
        	<a th:href="@{/images/default-image.jpg}" download>
			    <img th:src="@{/images/default-image.jpg}" alt="프로필 사진" class="profile-image">
			</a>
             
            <div class="tamagotchi-name">
                <span th:text="${tamagotchi.name}"></span>
            </div>
            <div class="tamagotchi-status" 
			     th:classappend="${((100 - tamagotchi.hunger) * 0.2 + (100 - tamagotchi.fatigue) * 0.3 + tamagotchi.happiness * 0.5) / 3 >= 16.6 
			     						? 'happy' : 'sad'}">
			    <span th:text="${((100 - tamagotchi.hunger) * 0.2 + (100 - tamagotchi.fatigue) * 0.3 + tamagotchi.happiness * 0.5) / 3 >= 16.6 
			    						? '&quot;너무 행복해요!&quot;' : '&quot;슬퍼요, 도와주세요!&quot;'}"></span>
			</div>
        </div>

        <!-- 타마고치 정보 테이블 -->
        <div class="table-section">
            <table class="table table-bordered">
		    <tbody>
		        <tr>
		            <td style="text-align: right;"><strong><i class="fas fa-calendar-alt icon"></i>탄생 일시</strong></td>
		            <td style="text-align: center;">
		                <span th:text="${tamagotchi.createDt}"></span>
		                (나의 <span th:text="${tamagotchi.tamagotchiId}"></span>번째 타마)
		            </td>
		        </tr>
		        <tr>
		            <td title="배고픔은 0%가 최고의 상태입니다;" style="text-align: right;"><strong><i class="fas fa-utensils icon"></i>배고픔</strong></td>
		            <td style="text-align: center;">
		            	<span id="hunger" title="0%가 최고의 상태입니다." 
		            	  	  th:text="${tamagotchi.hunger} + '%'"
		            	  	  th:attr="style='color: ' + (${tamagotchi.hunger} >= 80 ? 'red' : 'black')">
						 </span>
					</td>
		        </tr>
		        <tr>
		            <td title="피로도는 0%가 최고의 상태입니다;" style="text-align: right;"><strong><i class="fas fa-bed icon"></i>피로도</strong></td>
		            <td style="text-align: center;">
		            	<span id="fatigue" title="0%가 최고의 상태입니다." 
		            		  th:text="${tamagotchi.fatigue} + '%'" 
		            		  th:attr="style='color: ' + (${tamagotchi.fatigue} >= 80 ? 'red' : 'black')">
						</span>
					</td>
		        </tr>
		        <tr>
		            <td title="행복도는 100%가 최고의 상태입니다;" style="text-align: right;"><strong><i class="fas fa-sun icon"></i>행복도</strong></td>
		            <td style="text-align: center;">
					    <span id="happiness" title="100%가 최고의 상태입니다."
					          th:text="${tamagotchi.happiness} + '%'" 
						      th:attr="style='color: ' + (${tamagotchi.happiness} <= 30 ? 'red' : 'black')">
						 </span>
					</td>
		        </tr>
		        <tr>
		            <td style="text-align: right;"><strong><i class="fas fa-user-circle icon"></i>프로필 사진</strong></td>
		            <td style="text-align: center;">
		                <div class="file_list">
		                    <!-- 파일 리스트가 있을 경우 -->
		                    <div th:if="${not #lists.isEmpty(tamagotchi.fileInfoList)}">
		                        <a th:each="file : ${tamagotchi.fileInfoList}" 
		                           th:text="|${file.originalFileName} (${file.fileSize}kb)|"
		                           th:href="@{/tamagotchi/downloadTamagotchiFile.do(imageId=${file.imageId}, tamagotchiId=${file.tamagotchiId})}"></a>
		                    </div>
		                
		                    <!-- 파일 리스트가 없을 경우 -->
		                    <div th:if="${#lists.isEmpty(tamagotchi.fileInfoList)}">
		                          <p style="margin: 0; padding: 0;">등록하지 않았습니다.</p>
		                    </div>
		                </div>
		            </td>
		        </tr>
		    </tbody>
		</table>

        </div>

        <!-- 상태 변경 버튼들 -->
        <form id="frm" method="POST">
		    <input type="hidden" name="tamagotchiId" th:value="${tamagotchi.tamagotchiId}"/>
		    <input type="hidden" name="state" id="state">  <!-- state 값이 전달되도록 hidden 필드 추가 -->
		    
		    <div class="btn-group mb-3" role="group" style="width: 100%;">
		   		<button class="btn btn-hunger" id="btnHunger" type="button" name="state" value="hunger">밥주기</button>
		   		<button class="btn btn-sleep" id="btnSleep" type="button" name="state" value="sleep">잠재우기</button>
		        <button class="btn btn-play" id="btnPlay" type="button" name="state" value="play">놀아주기</button>  
		    </div>
		
		    <!-- 입양 보내기 버튼 -->
			<div class="text-center" >
			    <button class="btn btn-danger w-100" id="btnDelete" type="button" name="state" value="delete">입양 보내기</button>

			</div>
		</form>
    </div>
    
    <!-- 하단에 고정된 뒤로 가기 버튼 -->
    <div class="btn-wrapper">
    	<button type="button" class="btn-back" id="btnList" name="list" value="list">목록으로 가기</button>
    </div> 
    
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script>
	    $(function() {
	        // 공통 폼 제출 함수
	        function submitForm(action, state) {
	            let frm = $("#frm")[0];  // 폼 선택
	            frm.action = action;      // 폼의 action 속성 설정
	
	            // 'state' 필드에 전달받은 값 설정
	            let stateInput = frm.querySelector('input[name="state"]');  
	            if (stateInput) {
	                stateInput.value = state;  // state 필드에 값 설정
	            } else {
	                alert("폼에 'state' 필드가 없습니다.");  // state 필드가 없으면 경고
	            }
	
	            frm.submit();  // 폼 제출
	        }
	
	        // 각 버튼 클릭 시 해당 상태 값 전달 및 폼 제출
	        $("#btnHunger").on("click", function(event) {
	            event.preventDefault();  // 기본 동작 방지
	            submitForm("updateState.do", "hunger");  // 'hunger' 값 전달
	        });
	
	        $("#btnSleep").on("click", function(event) {
	            event.preventDefault();  // 기본 동작 방지
	            submitForm("updateState.do", "sleep");  // 'sleep' 값 전달
	        });
	
	        $("#btnPlay").on("click", function(event) {
	            event.preventDefault();  // 기본 동작 방지
	            submitForm("updateState.do", "play");  // 'play' 값 전달
	        });
	
	        $("#btnDelete").on("click", function(event) {
	            event.preventDefault();  // 기본 동작 방지
	            alert("다마고치가 입양갑니다.");  // 입양 메시지
	            submitForm("updateState.do", "delete");  // 'delete' 값 전달
	        });
	
	        // 목록 페이지로 이동
	        $("#btnList").on("click", function(event) {
	            event.preventDefault();  // 기본 동작 방지
	            location.href = "openTamagotchiList.do";  // 목록 페이지로 이동
	        });
	    });
	</script>
</body>
</html>
